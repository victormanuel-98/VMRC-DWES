<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crisis Core Materia API - Explorador</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/modern-normalize/1.1.0/modern-normalize.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: linear-gradient(135deg, #000000 0%, #4fc28c 100%);
      --card: #ffffff;
      --accent: #12288b;
      --accent-dark: #5568d3;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --muted: #6b7280;
      --soft: #f3f4f6;
      --border: #e5e7eb;
      --radius: 12px;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 20px 50px rgba(0, 0, 0, 0.15);
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      margin: 0;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: var(--bg);
      color: #1f2937;
      -webkit-font-smoothing: antialiased;
      padding: 0;
      overflow-x: hidden;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo h1 {
      font-size: 1.5rem;
      margin: 0;
      color: var(--accent);
      font-weight: 800;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      background: var(--soft);
      color: var(--muted);
    }

    .status-badge.online {
      background: #d1fae5;
      color: var(--success);
    }

    .status-badge.offline {
      background: #fee2e2;
      color: var(--error);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    .header-links {
      display: flex;
      gap: 10px;
    }

    .link-btn {
      padding: 8px 16px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .link-btn.primary {
      background: var(--accent);
      color: white;
    }

    .link-btn.primary:hover {
      background: var(--accent-dark);
      transform: translateY(-2px);
    }

    .link-btn.secondary {
      background: var(--soft);
      color: var(--accent);
    }

    .link-btn.secondary:hover {
      background: var(--border);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    .search-section {
      background: white;
      border-radius: var(--radius);
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: var(--shadow);
    }

    .search-title {
      font-size: 1.3rem;
      margin: 0 0 20px 0;
      color: var(--accent);
      font-weight: 700;
    }

    .search-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-input,
    .form-select {
      padding: 12px 16px;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      transition: all 0.2s;
      background: white;
    }

    .form-input:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-actions {
      display: flex;
      gap: 10px;
      grid-column: 1 / -1;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-family: inherit;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
      flex: 1;
    }

    .btn-primary:hover {
      background: var(--accent-dark);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: var(--soft);
      color: var(--muted);
    }

    .btn-secondary:hover {
      background: var(--border);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .results-info {
      font-size: 0.95rem;
      color: var(--muted);
    }

    .results-info strong {
      color: var(--accent);
      font-weight: 700;
    }

    .view-toggle {
      display: flex;
      gap: 5px;
      background: var(--soft);
      padding: 4px;
      border-radius: 8px;
    }

    .view-btn {
      padding: 8px 16px;
      border: none;
      background: transparent;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1.2rem;
      transition: all 0.2s;
    }

    .view-btn.active {
      background: white;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid var(--soft);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .empty-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .empty-state h3 {
      color: var(--accent);
      margin: 0 0 10px 0;
    }

    .empty-state p {
      color: var(--muted);
      margin: 0;
    }

    .materia-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .materia-card {
      background: white;
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      transition: all 0.3s;
      cursor: pointer;
      border: 2px solid transparent;
    }

    .materia-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
      border-color: var(--accent);
    }

    .materia-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 15px;
    }

    .materia-id {
      background: var(--soft);
      color: var(--muted);
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 700;
    }

    .materia-name {
      font-size: 1.3rem;
      font-weight: 700;
      color: #1f2937;
      margin: 0 0 8px 0;
    }

    .materia-type {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 600;
      background: linear-gradient(135deg, var(--accent), #764ba2);
      color: white;
    }

    .materia-description {
      color: var(--muted);
      font-size: 0.95rem;
      line-height: 1.5;
      margin: 15px 0 0 0;
    }

    .materia-list {
      background: rgb(119, 115, 115);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      margin-bottom: 30px;
    }

    .materia-list-item {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      transition: all 0.2s;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
    }

    .materia-list-item:last-child {
      border-bottom: none;
    }

    .materia-list-item:hover {
      background: var(--soft);
    }

    .materia-list-info {
      flex: 1;
    }

    .materia-list-name {
      font-weight: 700;
      font-size: 1.1rem;
      color: #1f2937;
      margin-bottom: 4px;
    }

    .materia-list-desc {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      padding: 20px;
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .pagination-btn {
      padding: 10px 16px;
      border: 2px solid var(--border);
      background: white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      font-family: inherit;
    }

    .pagination-btn:hover:not(:disabled) {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .pagination-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .pagination-btn.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .pagination-info {
      color: var(--muted);
      font-size: 0.9rem;
      padding: 0 15px;
    }

    .error-message {
      background: #a19d9d;
      color: var(--error);
      padding: 16px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 600;
    }

    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        align-items: stretch;
      }

      .header-links {
        justify-content: center;
      }

      .search-form {
        grid-template-columns: 1fr;
      }

      .materia-grid {
        grid-template-columns: 1fr;
      }

      .results-header {
        flex-direction: column;
        align-items: stretch;
      }

      .view-toggle {
        justify-content: center;
      }

      .pagination {
        flex-wrap: wrap;
      }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="logo">
        <h1>üéÆ Crisis Core Materia API</h1>
        <div class="status-badge" id="apiStatus">
          <span class="status-dot"></span>
          <span>Verificando...</span>
        </div>
      </div>
      <div class="header-links">
        <a href="/api-docs" class="link-btn secondary">üìñ Swagger</a>
        <a href="https://github.com" class="link-btn primary" target="_blank">‚≠ê GitHub</a>
      </div>
    </div>
  </div>

  <!-- Main Container -->
  <div class="container">
    <!-- Search Section -->
    <div class="search-section">
      <h2 class="search-title">Explorador de Materias</h2>

      <form class="search-form" id="searchForm">
        <div class="form-group">
          <label class="form-label" for="nameInput">Nombre</label>
          <input type="text" id="nameInput" class="form-input" placeholder="Ej: Fire, Cure...">
        </div>

        <div class="form-group">
          <label class="form-label" for="typeInput">Tipo</label>
          <input type="text" id="typeInput" class="form-input" placeholder="Ej: Magic, Command...">
        </div>

        <div class="form-group">
          <label class="form-label" for="sortBySelect">Ordenar por</label>
          <select id="sortBySelect" class="form-select">
            <option value="">-- Sin ordenar --</option>
            <option value="name">Nombre</option>
            <option value="type">Tipo</option>
            <option value="id">ID</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label" for="orderSelect">Orden</label>
          <select id="orderSelect" class="form-select">
            <option value="asc">Ascendente (A-Z)</option>
            <option value="desc">Descendente (Z-A)</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label" for="limitSelect">Resultados</label>
          <select id="limitSelect" class="form-select">
            <option value="10">10 por p√°gina</option>
            <option value="20">20 por p√°gina</option>
            <option value="30">30 por p√°gina</option>
            <option value="50">50 por p√°gina</option>
          </select>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">
            üîç Buscar Materias
          </button>
          <button type="button" class="btn btn-secondary" id="resetBtn">
            üîÑ Limpiar
          </button>
        </div>
      </form>
    </div>

    <!-- Error Message -->
    <div id="errorContainer"></div>

    <!-- Results Header -->
    <div class="results-header" id="resultsHeader" style="display: none;">
      <div class="results-info" id="resultsInfo">
        Mostrando <strong>0</strong> resultados
      </div>
      <div class="view-toggle">
        <button class="view-btn active" id="gridViewBtn" title="Vista en cuadr√≠cula">
          ‚äû
        </button>
        <button class="view-btn" id="listViewBtn" title="Vista en lista">
          ‚ò∞
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div id="loadingContainer" style="display: none;">
      <div class="loading">
        <div class="spinner"></div>
        <p>Cargando materias...</p>
      </div>
    </div>

    <!-- Empty State -->
    <div id="emptyContainer" class="empty-state">
      <div class="empty-icon">üéÆ</div>
      <h3>¬°Bienvenido al Explorador de Materias!</h3>
      <p>Usa el formulario de b√∫squeda para encontrar materias de Crisis Core.</p>
      <p style="margin-top: 10px;">Puedes filtrar por nombre, tipo, ordenar los resultados y paginar.</p>
    </div>

    <!-- Results Grid -->
    <div class="materia-grid" id="materiaGrid"></div>

    <!-- Results List -->
    <div class="materia-list" id="materiaList" style="display: none;"></div>

    <!-- Pagination -->
    <div class="pagination" id="paginationContainer" style="display: none;"></div>
  </div>

  <script>
    // Estado de la aplicaci√≥n
    const state = {
      currentPage: 1,
      totalPages: 1,
      totalResults: 0,
      viewMode: 'grid', // 'grid' o 'list'
      filters: {
        name: '',
        type: '',
        sortBy: '',
        order: 'asc',
        limit: 10
      },
      materias: []
    };

    // Elementos del DOM
    const elements = {
      searchForm: document.getElementById('searchForm'),
      resetBtn: document.getElementById('resetBtn'),
      nameInput: document.getElementById('nameInput'),
      typeInput: document.getElementById('typeInput'),
      sortBySelect: document.getElementById('sortBySelect'),
      orderSelect: document.getElementById('orderSelect'),
      limitSelect: document.getElementById('limitSelect'),
      apiStatus: document.getElementById('apiStatus'),
      errorContainer: document.getElementById('errorContainer'),
      loadingContainer: document.getElementById('loadingContainer'),
      emptyContainer: document.getElementById('emptyContainer'),
      resultsHeader: document.getElementById('resultsHeader'),
      resultsInfo: document.getElementById('resultsInfo'),
      materiaGrid: document.getElementById('materiaGrid'),
      materiaList: document.getElementById('materiaList'),
      paginationContainer: document.getElementById('paginationContainer'),
      gridViewBtn: document.getElementById('gridViewBtn'),
      listViewBtn: document.getElementById('listViewBtn')
    };

    // Mapeo de tipos de materia a emojis
    function getMateriaEmoji(type) {
      if (!type) return 'üíé';

      const typeMap = {
        'magic': '‚ú®',
        'fire': 'üî•',
        'ice': '‚ùÑÔ∏è',
        'lightning': '‚ö°',
        'wind': 'üí®',
        'earth': 'üåç',
        'water': 'üíß',
        'support': 'üõ°Ô∏è',
        'command': '‚öîÔ∏è',
        'independent': 'üîÆ',
        'complete': 'üåü',
        'summon': 'üêâ',
        'poison': '‚ò†Ô∏è',
        'gravity': 'üåÄ',
        'holy': '‚úùÔ∏è',
        'dark': 'üåë',
        'time': '‚è∞',
        'recovery': 'üíö',
        'heal': 'üíö',
        'energy': '‚ö°'
      };

      const lowerType = type.toLowerCase();

      // Buscar coincidencias en el nombre del tipo
      for (const [key, emoji] of Object.entries(typeMap)) {
        if (lowerType.includes(key)) {
          return emoji;
        }
      }

      return 'üíé'; // Emoji por defecto
    }

    // Verificar estado de la API
    async function checkApiStatus() {
      try {
        const response = await fetch('/api/materia/status');
        const data = await response.json();

        if (data.success) {
          elements.apiStatus.className = 'status-badge online';
          elements.apiStatus.querySelector('span:last-child').textContent = 'Online';
        } else {
          throw new Error('API no disponible');
        }
      } catch (error) {
        elements.apiStatus.className = 'status-badge offline';
        elements.apiStatus.querySelector('span:last-child').textContent = 'Offline';
      }
    }

    // Construir URL con par√°metros
    function buildSearchUrl(page = 1) {
      const params = new URLSearchParams();

      if (state.filters.name) params.append('name', state.filters.name);
      if (state.filters.type) params.append('type', state.filters.type);
      if (state.filters.sortBy) params.append('sortBy', state.filters.sortBy);
      if (state.filters.order) params.append('order', state.filters.order);
      params.append('page', page);
      params.append('limit', state.filters.limit);

      return `/api/materia?${params.toString()}`;
    }

    // Buscar materias
    async function searchMaterias(page = 1) {
      try {
        showLoading();
        hideError();

        const response = await fetch(buildSearchUrl(page));
        const data = await response.json();

        if (!data.success) {
          throw new Error(data.error || 'Error al obtener materias');
        }

        state.materias = data.data;
        state.currentPage = data.pagination.page;
        state.totalPages = data.pagination.totalPages;
        state.totalResults = data.pagination.total;

        hideLoading();
        renderResults();
        renderPagination();

      } catch (error) {
        hideLoading();
        showError(error.message);
      }
    }

    // Mostrar loading
    function showLoading() {
      elements.loadingContainer.style.display = 'block';
      elements.emptyContainer.style.display = 'none';
      elements.resultsHeader.style.display = 'none';
      elements.materiaGrid.style.display = 'none';
      elements.materiaList.style.display = 'none';
      elements.paginationContainer.style.display = 'none';
    }

    // Ocultar loading
    function hideLoading() {
      elements.loadingContainer.style.display = 'none';
    }

    // Mostrar error
    function showError(message) {
      elements.errorContainer.innerHTML = `
        <div class="error-message">
          <span>‚ö†Ô∏è</span>
          <span>${message}</span>
        </div>
      `;
      elements.emptyContainer.style.display = 'none';
      elements.resultsHeader.style.display = 'none';
      elements.materiaGrid.style.display = 'none';
      elements.materiaList.style.display = 'none';
      elements.paginationContainer.style.display = 'none';
    }

    // Ocultar error
    function hideError() {
      elements.errorContainer.innerHTML = '';
    }

    // Renderizar resultados
    function renderResults() {
      if (state.materias.length === 0) {
        elements.emptyContainer.innerHTML = `
          <div class="empty-icon">üîç</div>
          <h3>No se encontraron materias</h3>
          <p>Intenta con otros criterios de b√∫squeda.</p>
        `;
        elements.emptyContainer.style.display = 'block';
        elements.resultsHeader.style.display = 'none';
        return;
      }

      elements.emptyContainer.style.display = 'none';
      elements.resultsHeader.style.display = 'flex';

      // Actualizar info de resultados
      const start = (state.currentPage - 1) * state.filters.limit + 1;
      const end = Math.min(state.currentPage * state.filters.limit, state.totalResults);
      elements.resultsInfo.innerHTML = `
        Mostrando <strong>${start}-${end}</strong> de <strong>${state.totalResults}</strong> resultados
      `;

      if (state.viewMode === 'grid') {
        renderGridView();
      } else {
        renderListView();
      }
    }

    // Renderizar vista en cuadr√≠cula
    function renderGridView() {
      elements.materiaGrid.style.display = 'grid';
      elements.materiaList.style.display = 'none';

      elements.materiaGrid.innerHTML = state.materias.map(materia => `
        <div class="materia-card" onclick="viewMateriaDetail('${materia.name}')">
          <div class="materia-header">
            <div class="materia-id">${materia.type || 'Sin tipo'}</div>
          </div>
          <h3 class="materia-name">${getMateriaEmoji(materia.type)} ${materia.name || 'Sin nombre'}</h3>
          <span class="materia-type">${materia.type || 'Sin tipo'}</span>
          ${materia.description ? `<p class="materia-description">${materia.description}</p>` : ''}
        </div>
      `).join('');
    }

    // Renderizar vista en lista
    function renderListView() {
      elements.materiaGrid.style.display = 'none';
      elements.materiaList.style.display = 'block';

      elements.materiaList.innerHTML = state.materias.map(materia => `
        <div class="materia-list-item" onclick="viewMateriaDetail('${materia.name}')">
          <div class="materia-list-info">
            <div class="materia-list-name">${getMateriaEmoji(materia.type)} ${materia.name || 'Sin nombre'}</div>
            <div class="materia-list-desc">${materia.description || 'Sin descripci√≥n'}</div>
          </div>
          <span class="materia-type">${materia.type || 'Sin tipo'}</span>
        </div>
      `).join('');
    }

    // Renderizar paginaci√≥n
    function renderPagination() {
      if (state.totalPages <= 1) {
        elements.paginationContainer.style.display = 'none';
        return;
      }

      elements.paginationContainer.style.display = 'flex';

      let paginationHTML = `
        <button class="pagination-btn" onclick="goToPage(${state.currentPage - 1})" 
          ${state.currentPage === 1 ? 'disabled' : ''}>
          ‚Üê Anterior
        </button>
      `;

      // P√°ginas
      const maxButtons = 5;
      let startPage = Math.max(1, state.currentPage - Math.floor(maxButtons / 2));
      let endPage = Math.min(state.totalPages, startPage + maxButtons - 1);

      if (endPage - startPage < maxButtons - 1) {
        startPage = Math.max(1, endPage - maxButtons + 1);
      }

      if (startPage > 1) {
        paginationHTML += `<button class="pagination-btn" onclick="goToPage(1)">1</button>`;
        if (startPage > 2) {
          paginationHTML += `<span class="pagination-info">...</span>`;
        }
      }

      for (let i = startPage; i <= endPage; i++) {
        paginationHTML += `
          <button class="pagination-btn ${i === state.currentPage ? 'active' : ''}" 
            onclick="goToPage(${i})">
            ${i}
          </button>
        `;
      }

      if (endPage < state.totalPages) {
        if (endPage < state.totalPages - 1) {
          paginationHTML += `<span class="pagination-info">...</span>`;
        }
        paginationHTML += `<button class="pagination-btn" onclick="goToPage(${state.totalPages})">${state.totalPages}</button>`;
      }

      paginationHTML += `
        <button class="pagination-btn" onclick="goToPage(${state.currentPage + 1})" 
          ${state.currentPage === state.totalPages ? 'disabled' : ''}>
          Siguiente ‚Üí
        </button>
      `;

      elements.paginationContainer.innerHTML = paginationHTML;
    }

    // Ir a p√°gina
    function goToPage(page) {
      if (page < 1 || page > state.totalPages || page === state.currentPage) return;
      searchMaterias(page);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Ver detalle de materia
    async function viewMateriaDetail(name) {
      try {
        const response = await fetch(`/api/materia/${encodeURIComponent(name)}`);
        const data = await response.json();

        if (!data.success) {
          throw new Error('No se pudo obtener la materia');
        }

        const materia = data.data;
        const emoji = getMateriaEmoji(materia.type);
        const detailHTML = `
          <strong>Nombre:</strong> ${emoji} ${materia.name}<br>
          <strong>Tipo:</strong> ${materia.type}<br>
          ${materia.description ? `<strong>Descripci√≥n:</strong> ${materia.description}<br>` : ''}
          ${materia.stats ? `<strong>Stats:</strong> ${JSON.stringify(materia.stats, null, 2)}` : ''}
        `;

        alert(`${emoji} Detalle de Materia\n\n` + detailHTML.replace(/<br>/g, '\n').replace(/<[^>]*>/g, ''));
      } catch (error) {
        alert('‚ö†Ô∏è Error: ' + error.message);
      }
    }

    // Cambiar vista
    function changeView(mode) {
      state.viewMode = mode;

      elements.gridViewBtn.classList.toggle('active', mode === 'grid');
      elements.listViewBtn.classList.toggle('active', mode === 'list');

      renderResults();
    }

    // Event Listeners
    elements.searchForm.addEventListener('submit', (e) => {
      e.preventDefault();

      state.filters.name = elements.nameInput.value.trim();
      state.filters.type = elements.typeInput.value.trim();
      state.filters.sortBy = elements.sortBySelect.value;
      state.filters.order = elements.orderSelect.value;
      state.filters.limit = parseInt(elements.limitSelect.value);
      state.currentPage = 1;

      searchMaterias(1);
    });

    elements.resetBtn.addEventListener('click', () => {
      elements.searchForm.reset();
      state.filters = {
        name: '',
        type: '',
        sortBy: '',
        order: 'asc',
        limit: 10
      };
      state.currentPage = 1;

      elements.emptyContainer.innerHTML = `
        <div class="empty-icon">üéÆ</div>
        <h3>¬°Bienvenido al Explorador de Materias!</h3>
        <p>Usa el formulario de b√∫squeda para encontrar materias de Crisis Core.</p>
        <p style="margin-top: 10px;">Puedes filtrar por nombre, tipo, ordenar los resultados y paginar.</p>
      `;
      elements.emptyContainer.style.display = 'block';
      elements.resultsHeader.style.display = 'none';
      elements.materiaGrid.style.display = 'none';
      elements.materiaList.style.display = 'none';
      elements.paginationContainer.style.display = 'none';
      hideError();
    });

    elements.gridViewBtn.addEventListener('click', () => changeView('grid'));
    elements.listViewBtn.addEventListener('click', () => changeView('list'));

    // Inicializar
    checkApiStatus();
    setInterval(checkApiStatus, 30000); // Verificar cada 30 segundos
  </script>
  <a href="/api/materia?limit=5" class="btn btn-secondary">üß™ Probar API</a>
  </div>
  </div>
</body>

</html>